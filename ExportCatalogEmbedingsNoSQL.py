import os
import pandas as pd
import azure.cosmos.documents as documents
import azure.cosmos.cosmos_client as cosmos_client
import azure.cosmos.exceptions as exceptions
from azure.cosmos.partition_key import PartitionKey
import datetime
import config
import pymongo


# development amacı ile kaynakları oluşturma ve silme rutinlerini ekleyerek
# maliyetleri süper azaltmak mümkün olabilir.
# yarın buna bakmam laızm. 
# prod tarafında tabibu çok mümkün olmayacaktır. 
# Bu uygulama CosmosDB'ye veri ekleme işlemini gerçekleştirmektedir.
# komut satırından bir kez çalıştırılır.
# demelerde nosql vector verilerinin gönderilmesi ve alınması (özellikle alınması) konusunda çok yavaş kaldı.

# https://learn.microsoft.com/en-us/azure/cosmos-db/mongodb/vcore/vector-search
# yukarıdaki adresteki javascript komutları
# mongodb üzerinde çalıştırılır.
# bunun en kolay yolu şimdiye kadar bulduğum:
# vscode mongodb plugini yapmak. bunun playground
# fonskiyonunu kullanmak. 
# azure mongodb arayüzünde verileri gösteren bir yer yok
# yine mongodb plugin üzerinden verileri ve indexleri de görmek mümkün.
# index oluşturma aşağıdaki şekidle yapılıyor. 
# openai index embedingsleri 1536 boyutlu
"""
db.runCommand({
  createIndexes: 'exampleCollection',
  indexes: [
    {
      name: 'vectorSearchIndex',
      key: {
        "vectorContent": "cosmosSearch"
      },
      cosmosSearchOptions: {
        kind: 'vector-ivf',
        numLists: 100,
        similarity: 'COS',
        dimensions: 1536
      }
    }
  ]
});

DB oluşturmak ve altında da koleksiyon oluşturmak için kullanılan kod.

const database = 'EnoctaEmbeddings';
const collection = 'Catalog';

// Create a new database.
use(database);

// Create a new collection.
db.createCollection(collection);


"""


settings = {
    'host': os.environ.get('ACCOUNT_HOST', 'https://aiexperiment.documents.azure.com:443/'),
    'master_key': os.environ.get('ACCOUNT_KEY', 'osGQ0NoqEDvY2gjfyn8fMeeA388AZzA1NVOiDxpDRSdrNnNJgg3bX90BsVrXf7FFlXZY9kkbc3N1HVx0HpU8VA=='),
    'database_id': os.environ.get('COSMOS_DATABASE', 'samplemongodb'),
    'container_id': os.environ.get('COSMOS_CONTAINER', 'vectors'),
    'collection_id': os.environ.get('COSMOS_COLLECTION', 'exampleCollection'),
}

HOST = config.settings['host']
MASTER_KEY = config.settings['master_key']
DATABASE_ID = config.settings['database_id']
CONTAINER_ID = config.settings['container_id']
COLLECTION_ID = config.settings['collection_id']

def Item(item_id, name):
    order1 = {'id' : item_id,
        'partitionKey' : 'Account1',
        'name' : name,
        }
    return order1
    
def CreateItem(item_id, name):
    client = cosmos_client.CosmosClient(HOST, {'masterKey': MASTER_KEY}, user_agent="CosmosDBPythonQuickstart", user_agent_overwrite=True)
    db = client.get_database_client(DATABASE_ID)
    container = db.get_container_client(CONTAINER_ID)
    order = Item("SalesOrder3", "test")
    container.create_item(body=order)

def EmbeddingItem(index, embedding):
    item = {'id' : index,
            'embedding' : embedding,}
    return item

def CreateEmbedingItem():
    client = cosmos_client.CosmosClient(HOST, {'masterKey': MASTER_KEY}, user_agent="CosmosDBPythonQuickstart", user_agent_overwrite=True)
    db = client.get_database_client(DATABASE_ID)
    container = db.get_container_client(CONTAINER_ID)
    embeding = EmbeddingItem("1", "[34,54,65,76,]")
    container.create_item(body=embeding)

   
def ReadEmbeddingsFromCosmoDB():
    client = cosmos_client.CosmosClient(HOST, {'masterKey': MASTER_KEY}, user_agent="CosmosDBPythonQuickstart", user_agent_overwrite=True)
    db = client.get_database_client(DATABASE_ID)
    container = db.get_container_client(CONTAINER_ID)   
    item_list = list(container.read_all_items(max_item_count=100))
    print('Found {0} items'.format(item_list.__len__()))
    for doc in item_list:
        print('Item Id: {0}'.format(doc.get('id')))



def query_items(id):
    print('\nQuerying for an  Item by Partition Key\n')

    client = cosmos_client.CosmosClient(HOST, {'masterKey': MASTER_KEY}, user_agent="CosmosDBPythonQuickstart", user_agent_overwrite=True)
    db = client.get_database_client(DATABASE_ID)
    container = db.get_container_client(CONTAINER_ID)   

    # Including the partition key value of account_number in the WHERE filter results in a more efficient query
    items = list(container.query_items(
        query="SELECT * FROM r WHERE r.id=@id_number",
        parameters=[
            { "name":"@id_number", "value": id }
        ]
    ))

    print('Item queried by id  {0}'.format(items[0].get("id")))

def createvectorindex():
    client = cosmos_client.CosmosClient(HOST, {'masterKey': MASTER_KEY}, user_agent="CosmosDBPythonQuickstart", user_agent_overwrite=True)
    db = client.get_database_client(DATABASE_ID)
    json = {'createIndexes' : 'exampleCollection',
            'indexes': [
                {
                'name': 'vectorSearchIndex',
                'key': {
                    "vectorContent": "cosmosSearch"
                },
                'cosmosSearchOptions': {
                    'kind': 'vector-ivf',
                    'numLists': 100,
                    'similarity': 'COS',
                    'dimensions': 3
                }
                }
            ]
            }
    
    db.createindexes(json)
    return

def createmongodbvectorindex():
    # Connect to the Cosmos DB using the Azure Cosmos Client
    client = cosmos_client.CosmosClient(HOST, {'masterKey': MASTER_KEY}, user_agent="CosmosDBPythonQuickstart", user_agent_overwrite=True)
    db = client.get_database_client(DATABASE_ID)
    container = db.get_container_client("vectors")  
    # Define the index to be created
    index_name = "vectorSearchIndex"
    index_key = [("vectorContent", "cosmosSearch")]
    index_options = {
        "kind": "vector-ivf",
        "numLists": 100,
        "similarity": "COS",
        "dimensions": 3
    }
    container.createIndex(index_key, name=index_name, options=index_options)
    print("Index created successfully")

def deletemongodbrecords():
    # Connect to the Cosmos DB using the Azure Cosmos Client
    client = cosmos_client.CosmosClient(HOST, {'masterKey': MASTER_KEY}, user_agent="CosmosDBPythonQuickstart", user_agent_overwrite=True)
    db = client.get_database_client(DATABASE_ID)
    container = db.get_container_client("vectors")  
    # Delete all records in the collection
    query = "SELECT * FROM c"
    result = container.query_items(query, enable_cross_partition_query=True)

    for document in result:
        print(document['id'])        
        container.delete_item(item="1", partition_key="/")    

    print("Deleted:", result.deleted_count)
    return

def CreateDatabase():
    client = pymongo.MongoClient('mongodb+srv://byucelyigit:burak123A@vectormongo.mongocluster.cosmos.azure.com/?tls=true&authMechanism=SCRAM-SHA-256&retrywrites=false&maxIdleTimeMS=120000')
    db=client['EnoctaEmbeddings']
    db.create_collection('vectors')


def ReadEmbeddings():
    df_embeddings = pd.read_csv('embeddings_eng.csv')    
    # write a code that show current directory
    print(os.getcwd())
    # write a code that list first four items of df_embeddings
    print(df_embeddings.head())
    # write a code that show the number of rows and columns of df_embeddings
    print(df_embeddings.shape)
    return df_embeddings

# aşağıdaki fonksiyonu  bir kez çalıştırmak lazım. 
# embeddings csv dosyasındaki embeddings verilerini cosmodb'ye yazar.
def ExportEmbeddings():
    embeddingList = ReadEmbeddings()
    CreateEmbedingItems(embeddingList) 

# burada bir hata oluştu. vektör bilgisi rakam olarak değil de string olarak girilmiş oldu. bunu düzeltmek lazım. 
def CreateEmbedingItems(embeddingList):
    client = pymongo.MongoClient('mongodb+srv://byucelyigit:burak123A@vectormongo.mongocluster.cosmos.azure.com/?tls=true&authMechanism=SCRAM-SHA-256&retrywrites=false&maxIdleTimeMS=120000')
    db = client.get_database('EnoctaEmbeddings')
    # collection = db['Catalog']
    # limited_df = embeddingList.head(5)
    for index, row in embeddingList.iterrows():
        # convert index into a string
        i = str(index+1)
        print("index:") 
        print(i)
        embeding = EmbeddingItem(i, row['embedding'])
        db.Catalog.insert_one(embeding)
        print("item created")

def EmbeddingItem(index, embedding):
    item = {'id' : index,
            'vectorContent' : embedding}
    return item

def searchmongodb():
    # vektör araması çalışan versiyon
    # index oluşturma işlemi javascript playground ile yapıldı.

    client = pymongo.MongoClient('mongodb+srv://byucelyigit:burak123A@vectormongo.mongocluster.cosmos.azure.com/?tls=true&authMechanism=SCRAM-SHA-256&retrywrites=false&maxIdleTimeMS=120000')
    db = client.get_database('EnoctaEmbeddings')
    # collection = db['exampleCollection']
    # client = cosmos_client()

    # db = client.samplemongodb.
    # 

    # container = db.get_container_client("vectors")

    # Define the query vector
    queryVector = [0.016803529113531113, -0.003750352654606104, -0.020432116463780403, -0.0327303521335125, -0.02715352736413479, 0.010928381234407425, -0.04030411317944527, 0.0032389408443123102, -0.021040940657258034, -0.011969469487667084, -0.003747308626770973, 0.02334229275584221, -0.00041095586493611336, -0.004203926306217909, 0.003494646865874529, -0.002394198440015316, 0.01948235183954239, -0.00025836945860646665, 0.005853837821632624, -0.006483970209956169, -0.01018561702221632, 0.008608764037489891, -0.006079102400690317, 0.0011735073057934642, -0.016304293647408485, -0.016499117016792297, 0.015610233880579472, -0.004901029169559479, 0.004310470074415207, -0.018544763326644897, 0.0041947937570512295, 0.03292517364025116, -0.02576540969312191, -0.01809423416852951, -0.04563741013407707, -0.003902558470144868, 0.00343680870719254, -0.00774423498660326, 0.0062343524768948555, -0.0228795874863863, 0.03385058417916298, 0.003369837999343872, 0.000910191098228097, 0.009101911447942257, -0.024937409907579422, -0.003729043761268258, -0.019604116678237915, -0.01192685216665268, -0.011646793223917484, 0.03031940944492817, 0.016097292304039, -0.006054749712347984, -0.018130764365196228, -0.03287646919488907, -0.024852175265550613, 0.006605735048651695, -0.017972469329833984, 0.01972588151693344, -0.0002960404090117663, -0.00030288967536762357, 0.0063926465809345245, -0.014830940403044224, 0.0012168859830126166, -0.001792985131032765, -0.005598132032901049, 0.01953105814754963, -0.030952585861086845, 0.009503734298050404, -0.024255527183413506, 0.025521880015730858, 0.014623939990997314, 0.028395527973771095, 0.014088175259530544, -0.021369704976677895, 0.06628870218992233, 0.011805087327957153, -0.006514411419630051, -0.003914734814316034, -0.03336352854967117, 0.008566146716475487, 0.029053056612610817, -0.01761935092508793, 0.0031658820807933807, 0.0037381763104349375, 0.0162312351167202, 0.009071470238268375, -0.012243440374732018, 0.045004233717918396, -0.019421469420194626, 0.004971043672412634, 0.0003487417125143111, 0.006094323005527258, 0.010599616914987564, 9.636534377932549e-05, 0.0064413524232804775, -0.006054749712347984, -0.019311880692839622, 0.013381940312683582, -0.022611703723669052, -0.02729964442551136, -0.0055128964595496655, 0.0010319558205083013, -0.014356058090925217, -0.004027367569506168, -0.01383246947079897, -0.011506764218211174, 0.013467175886034966, 0.00925411656498909, 0.008432205766439438, 0.0037594849709421396, -0.002672735136002302, 0.0017458013026043773, -0.00037499720929190516, -0.025546234101057053, 0.010106469504535198, 0.004258720204234123, 0.0104839401319623, -0.01495270524173975, -0.010763999074697495, -0.028614703565835953, 0.01906835101544857, -0.0032785143703222275, 0.018995292484760284, -0.0019451910629868507, -0.005372867453843355, 0.00562857324257493, 0.02203940972685814, -0.01490399893373251, -0.014039469882845879, 0.0011666580103337765, 0.012967940419912338, -0.012980116531252861, 0.029710587114095688, -0.011939028277993202, -0.01123279333114624, 0.016389528289437294, -0.01423429325222969, 0.014380411244928837, -0.04186270385980606, 0.006910146679729223, 0.030903879553079605, -0.0013257131213322282, -0.0020928308367729187, -0.014197763986885548, 0.004337867256253958, -0.0023241837043315172, 0.01702270470559597, 0.009570705704391003, 0.008633117191493511, 0.0033515733666718006, 0.022051585838198662, -0.016766998916864395, 0.032024115324020386, 0.015500646084547043, 0.016206881031394005, 0.011841616593301296, -0.0036986027844250202, -0.0052206614054739475, -0.020152056589722633, -0.008371323347091675, 0.01013691071420908, -0.005984734743833542, 0.018617821857333183, -0.026203762739896774, 0.01740017533302307, 0.012286057695746422, 0.011640705168247223, -0.04539388045668602, 0.013101881369948387, -0.012121675536036491, -0.021357528865337372, 0.0403771735727787, -0.014977057464420795, 0.027518821880221367, 0.013978587463498116, 0.016072940081357956, 0.015208411030471325, -0.027543174102902412, 0.00341245555318892, -0.005041058640927076, -0.04568611457943916, 0.015378881245851517, 0.02725093998014927, -0.00846873503178358, -0.01906835101544857, 0.005756426136940718, -0.006642264313995838, -0.0026894777547568083, 0.02893129177391529, -0.012894881889224052, 0.008535705506801605, 0.030027175322175026, -0.0236345287412405, -0.0012176469899713993, -0.6604517102241516, 0.00684926426038146, 0.009448940865695477, 0.024937409907579422, 0.02893129177391529, 0.0005270128604024649, 0.010544822551310062, 0.009400234557688236, -0.022124646231532097, -0.02306223288178444, 0.0022161174565553665, 0.004870587959885597, -0.006958852522075176, -0.005488543771207333, -0.006739675998687744, -0.01420994009822607, -0.006082146428525448, -0.01372288167476654, -0.002875169040635228, -0.010112558491528034, -0.02078523300588131, 0.04376223310828209, 0.008517440408468246, -0.0021613233257085085, 0.020164234563708305, 0.010252587497234344, 0.0017564557492733002, -0.022733468562364578, -0.01439258735626936, -0.003369837999343872, -0.01318711694329977, -0.006623999681323767, 0.026520350947976112, 0.015792882069945335, 0.03414282202720642, -0.020078998059034348, -0.013296704739332199, -0.002316573401913047, -0.007847734726965427, 0.026520350947976112, -0.0064413524232804775, -0.004441367462277412, 0.011086675338447094, 0.0013964888639748096, 0.001613382250070572, 0.006289146840572357, 0.014027292840182781, -0.0027777571231126785, 0.03743046894669533, 0.029174821451306343, -0.010033410973846912, -0.010477852076292038, -0.0008378933416679502, 0.01642605848610401, -0.010459587909281254, 0.023183997720479965, 0.02441382221877575, -0.003893426153808832, -0.006910146679729223, 0.0009665073012001812, 0.0013318014098331332, -0.0033667939715087414, 0.0037533969152718782, -0.019360587000846863, -0.014855293557047844, 0.005028882063925266, -0.006100411526858807, -0.020078998059034348, 0.02375629171729088, 0.0031049998942762613, -0.016024233773350716, 0.01334541104733944, -0.00593907292932272, 0.005196308251470327, 0.0038690732326358557, 0.0021126174833625555, 0.039037760347127914, -0.005741205532103777, 0.008712263777852058, 0.011177998967468739, 0.01004558801651001, -0.00687361741438508, -0.0076042055152356625, 0.02888258546590805, 0.013735057786107063, 0.0015798968961462379, -0.0003255303017795086, 0.0013972498709335923, -0.011969469487667084, 0.0077016171999275684, 0.001640779315494001, 0.00271535268984735, 0.009540264494717121, 0.012724410742521286, 0.005619440693408251, 0.011823352426290512, 0.0008051690529100597, -0.017278410494327545, 0.018666528165340424, -0.0020212940871715546, 0.01841082237660885, 0.011299763806164265, 0.003199367318302393, 0.0032906909473240376, -0.004362220410257578, -0.0009870551293715835, -0.020407764241099358, 0.009826411493122578, 0.0355309396982193, -0.005324161611497402, -0.007311969995498657, -0.00042922055581584573, 0.0013614814961329103, -0.002136970404535532, -0.006118676159530878, -0.02515658736228943, 0.005634661298245192, 0.01893441006541252, 0.03777140751481056, -0.00687361741438508, 0.014611763879656792, 0.029174821451306343, 0.046903762966394424, -0.013235822319984436, 0.0012884227326139808, -0.0066483523696660995, -0.028249409049749374, -0.015050116926431656, -0.011366734281182289, 0.01720535196363926, 0.003990837838500738, 0.009424587711691856, 0.01953105814754963, -0.016913115978240967, 0.009875116869807243, 0.00400910247117281, 0.004712293855845928, -0.01243826374411583, 0.006368293892592192, -0.020529527217149734, -0.018155116587877274, -0.008377411402761936, -0.011037969961762428, 0.006276970263570547, -0.022636057808995247, -0.023926762863993645, -0.006934499368071556, -0.0045996615663170815, -0.010757911019027233, 0.005391132086515427, 0.05167693644762039, -0.012663528323173523, -0.029467057436704636, -0.0002307821559952572, 0.003735132049769163, 0.012182557955384254, -0.02446252852678299, -0.010130822658538818, -0.00985685270279646, -0.010733557865023613, -0.00720847025513649, 0.00894970539957285, -0.0168765876442194, 0.021613234654068947, -0.0036651173140853643, -0.014599586836993694, -0.0011187131749466062, 0.019372763112187386, -0.02203940972685814, -0.021406233310699463, -0.0012366727460175753, -0.014088175259530544, 0.0012830954510718584, 0.023183997720479965, 0.023610174655914307, 0.008237381465733051, -0.006042573135346174, 0.017083587124943733, 0.0013987720012664795, -0.02241688035428524, -0.018118586391210556, -2.7777572540799156e-05, -0.006036485079675913, -0.004136955831199884, 0.013491528108716011, 0.006264793686568737, 0.005713808350265026, 0.04159482195973396, -0.015184057876467705, -0.007287617307156324, 0.008852293714880943, -0.003009109990671277, -0.012590469792485237, 0.018593469634652138, -0.013954234309494495, 0.021150527521967888, -0.013759410940110683, -0.009917734190821648, 0.006800558418035507, 0.02464517392218113, 0.0488276444375515, -0.00988729391247034, 0.040815528482198715, -0.006228264421224594, 0.029320938512682915, -0.014587410725653172, -0.015549351461231709, 0.00010778078285511583, 0.034021057188510895, 0.009534175507724285, -0.002607286674901843, -0.02386588044464588, -0.006550940684974194, -0.010167351923882961, -0.017935939133167267, 0.01174420490860939, -0.014356058090925217, 0.006782293785363436, 0.003747308626770973, 0.012578293681144714, -0.010891851969063282, -0.014331704936921597, 0.02795717492699623, 0.014039469882845879, -0.027080468833446503, 0.012419999577105045, 0.010015146806836128, 0.008681822568178177, 0.02185676246881485, -0.018496057018637657, -0.007214558310806751, -0.021272292360663414, 0.021613234654068947, -0.006977117154747248, 0.01697399839758873, 0.005153690930455923, 0.014015116728842258, -0.02045646868646145, 0.052115291357040405, -0.0010760955046862364, 0.022295115515589714, -0.011318028904497623, 0.01586594060063362, -0.010051676072180271, 0.026106351986527443, 0.019701527431607246, 0.016572175547480583, 0.01985982246696949, -0.006356117315590382, 0.02009117603302002, -0.011318028904497623, 0.010843146592378616, -0.005388088058680296, -0.006502234842628241, -0.0010296726832166314, -0.042812466621398926, 0.01655999943614006, 0.034118469804525375, -0.006176514085382223, 0.011640705168247223, 0.005479411222040653, 0.03952481970191002, 0.02041994035243988, 0.013601116836071014, 0.017789822071790695, 0.012858351692557335, -0.020773056894540787, -0.011147557757794857, -0.018301233649253845, -0.037552233785390854, -0.015098822303116322, -0.01313841063529253, 0.031220467761158943, 0.005884279031306505, -0.01369852852076292, -0.011190176010131836, 0.015524999238550663, -0.014757880941033363, 0.012858351692557335, 0.0027610145043581724, -0.012383469380438328, -0.013223646208643913, 0.000899536709766835, 0.01702270470559597, 0.002624029293656349, -0.012858351692557335, -0.010550910606980324, -0.020018115639686584, -0.02642294019460678, -0.012590469792485237, -0.026301175355911255, 0.026155056431889534, -0.023183997720479965, 0.0022998307831585407, -0.024474704638123512, -0.0014193197712302208, 0.025887174531817436, -0.005917764268815517, -0.027007410302758217, 0.01176855806261301, -0.0057807788252830505, -0.032486822456121445, -0.00421001436188817, -0.014733528718352318, 0.011409352533519268, -0.006206955295056105, -0.025083526968955994, -0.01548846997320652, 0.009010587818920612, -0.0063317641615867615, -0.028565997257828712, 0.021089645102620125, -0.008079087361693382, 0.03153705596923828, 0.009881204925477505, 0.011701587587594986, -0.008693999610841274, -0.001744279288686812, 0.034995175898075104, -0.02878517471253872, -0.023512763902544975, -0.016633057966828346, -0.021089645102620125, -0.001382790389470756, 0.06989293545484543, 0.0005060845287516713, -0.008986234664916992, 0.0027077423874288797, -0.018264705315232277, -0.03891599923372269, -0.021747175604104996, -0.013430646620690823, -0.005108029115945101, -0.005403308663517237, 0.007878175936639309, -0.01669394038617611, 0.015500646084547043, -0.018203822895884514, -0.002520529320463538, 0.009321087971329689, 0.0026088086888194084, -0.021333174780011177, 0.0056255292147397995, -0.02622811496257782, -0.006654440890997648, 0.0034702939447015524, -0.004870587959885597, 0.008310440927743912, 0.005001484882086515, -0.016170352697372437, 0.020200762897729874, 0.03772270306944847, -0.01390552893280983, -0.03976834937930107, -0.007470264099538326, 0.0006407867185771465, 0.011366734281182289, 0.015330175869166851, 0.014429116621613503, 0.044297996908426285, -0.005485499743372202, -0.004572264384478331, 0.03898905590176582, -0.03005152754485607, 0.020407764241099358, -0.015744175761938095, 0.020432116463780403, -0.013308881781995296, 0.018240351229906082, -0.006194779183715582, -0.010922293178737164, 0.026203762739896774, 0.005890367086976767, -0.02060258761048317, 0.01976240985095501, -0.001541084493510425, -0.04770740866661072, -0.005948205478489399, 3.158272011205554e-05, 0.005187176167964935, 0.00402127904817462, -3.0250917916418985e-05, -0.019409293308854103, -0.02683693915605545, -0.017412351444363594, -0.010502205230295658, 0.010094293393194675, -0.008809675462543964, -0.018763940781354904, -0.01541541051119566, -0.020444292575120926, -0.012194734066724777, -0.004471808671951294, 0.0018173381686210632, 0.008523528464138508, -0.012048617005348206, -0.01067267544567585, -0.018106410279870033, 0.02208811603486538, 0.009686381556093693, 0.028030233457684517, -0.011738116852939129, -0.006009087897837162, 0.001847779261879623, 0.012407822534441948, -0.02116270363330841, 0.02129664644598961, 0.004380485042929649, 0.0010273896623402834, 0.011756381951272488, -0.018130764365196228, -0.007579852361232042, 0.010216058231890202, 0.010587440803647041, 0.004082161467522383, 0.017497587949037552, -0.005792955402284861, -0.029150469228625298, 0.01072138175368309, -0.017217528074979782, -0.020663470029830933, -0.007945146411657333, -0.002829507226124406, -0.004106514621526003, 0.011104940436780453, -0.002624029293656349, 0.01034999918192625, 0.005293720401823521, 0.01651129312813282, 0.028590351343154907, -0.0061734700575470924, 0.02046864479780197, -0.01104405801743269, -0.012870528735220432, 0.022173350676894188, -0.031220467761158943, 0.02790846861898899, 0.019226646050810814, 0.02795717492699623, 0.025911526754498482, -0.028346821665763855, 0.013795940205454826, 0.007153675891458988, -0.03153705596923828, 0.0314396433532238, -0.05898281931877136, 0.0014725917717441916, -5.4033083870308474e-05, -0.004885808564722538, 0.00948547013103962, -0.003945176023989916, -0.021978527307510376, 0.012663528323173523, 0.012182557955384254, -0.011366734281182289, 0.00946720503270626, -0.02009117603302002, -0.0009490036172792315, -0.030757762491703033, -0.01053264643996954, -0.044395409524440765, 0.02065129205584526, -0.0249252337962389, -0.029004350304603577, 0.006133896764367819, -0.0054154847748577595, -0.00192997045814991, -0.0176315288990736, -0.028444234281778336, -0.03270599618554115, 0.006176514085382223, 0.014526528306305408, -0.008006028831005096, -0.0030562938190996647, -0.006611823104321957, 0.016121646389365196, -0.020054645836353302, -0.007939058355987072, 0.007914705201983452, -0.03056293912231922, -0.004127823282033205, -0.004980176221579313, 0.00018416911188978702, 0.027323998510837555, 0.026447292417287827, -0.027421409264206886, -0.002933007199317217, 0.01591464690864086, -0.00246573518961668, 0.011634617112576962, -0.03399670496582985, -0.006206955295056105, -0.03163446858525276, -0.008876646868884563, 0.03377752751111984, 0.006133896764367819, -0.00494364695623517, -0.02520529180765152, 0.01850823312997818, 0.036261528730392456, -0.005485499743372202, 0.012967940419912338, -0.003783837892115116, -0.019786763936281204, 0.0076650879345834255, 0.000796036736574024, 0.005601176060736179, 0.05245622992515564, 0.004980176221579313, -0.025132233276963234, 0.008182588033378124, 0.00014174172247294337, 0.014757880941033363, -0.005500720348209143, 0.017509764060378075, -0.006800558418035507, 0.021783703938126564, -0.01567111723124981, -0.0016468674875795841, -0.04115646705031395, 0.011896410956978798, -0.022709116339683533, -0.024109410122036934, 0.027737997472286224, -0.00237745582126081, 0.011147557757794857, 0.002502264454960823, 0.00770770525559783, -0.028103291988372803, -0.0015357572119683027, -0.012346940115094185, -0.011287587694823742, 2.159420728276018e-05, -0.000199009184143506, -0.0009002977167256176, -0.004803617484867573, -0.01125714648514986, -0.004301337990909815, -0.006319587584584951, 0.018483880907297134, -0.011050146073102951, -0.0014999888371676207, 0.018155116587877274, -0.004289161413908005, -0.01679135113954544, -0.007951234467327595, 0.02182023413479328, 0.0008759447955526412, 0.03842893987894058, 0.04252023249864578, 0.022112468257546425, -0.028127646073698997, 0.013077528215944767, 0.020760880783200264, -0.016669586300849915, 0.016620881855487823, 0.00439570564776659, -0.00564074981957674, -0.016072940081357956, 0.011981646530330181, 0.03575011342763901, -0.018155116587877274, -0.016986174508929253, 0.015841586515307426, 0.0002741608186624944, 0.007774675730615854, -0.018995292484760284, 0.018398646265268326, -0.029004350304603577, 0.019969411194324493, -0.011171910911798477, 0.010057764127850533, -0.021004410460591316, -0.005445925984531641, -0.03139093890786171, 0.0006541047478094697, 0.010130822658538818, 0.013479351997375488, -0.012389558367431164, -0.013467175886034966, -0.006885793525725603, -0.009059293195605278, -0.029783645644783974, -0.009223676286637783, -0.01920229196548462, 0.02130882255733013, -0.010776176117360592, 0.004846234805881977, -0.007275440730154514, 0.006423087790608406, -0.007464176043868065, 0.021187057718634605, -0.004645323380827904, 0.02367105707526207, -0.022355997934937477, -0.021832410246133804, 0.005488543771207333, 0.019689351320266724, 0.01143979374319315, 0.009984705597162247, -0.000674652517773211, -0.01280964631587267, -0.0016072939615696669, -0.006054749712347984, -0.0020212940871715546, 0.013929881155490875, -0.007263264153152704, 0.010843146592378616, -0.012724410742521286, -0.019470175728201866, -0.011658970266580582, -0.00612780824303627, 0.04400576278567314, -0.02055388130247593, 0.0032906909473240376, -0.011263234540820122, -0.0021476249676197767, -0.0011057757074013352, -0.027421409264206886, 0.0041460879147052765, -0.002698610071092844, 0.018544763326644897, -0.023792821913957596, -0.005351558327674866, -0.03297388181090355, 0.017704587429761887, -0.018264705315232277, 0.02088264562189579, -0.02018858678638935, -0.004063896834850311, 0.022100292146205902, -0.012687881477177143, 0.0018675660248845816, -0.010666587390005589, 0.005942117422819138, 0.008511352352797985, -0.0007366764475591481, -0.02284305728971958, -0.034532468765974045, 0.005034970119595528, 0.011646793223917484, -0.01744888164103031, -0.02231946960091591, 0.007768587674945593, 0.008657470345497131, -0.004006058443337679, 0.00580208795145154, -0.02380499802529812, -0.002165889600291848, 0.02147929184138775, 0.022891763597726822, -0.004127823282033205, 0.02510788105428219, -0.013101881369948387, -0.004888852592557669, 0.00017151699285022914, -0.01761935092508793, -0.020152056589722633, -0.02380499802529812, -0.023683233186602592, -0.014002940617501736, 0.006197823211550713, 0.002601198386400938, -0.014672646299004555, 0.023001352325081825, 0.023610174655914307, 0.024121586233377457, 0.01548846997320652, -0.012316498905420303, -0.010063852183520794, -0.008894911035895348, -0.01385682262480259, -0.042154937982559204, 0.006703146733343601, -0.00031582717201672494, 0.02437729202210903, -0.007951234467327595, 0.008328705094754696, -0.020078998059034348, -0.005774690769612789, -0.046246230602264404, 0.0024033307563513517, -0.015184057876467705, 0.020395586267113686, -0.0001536328054498881, -0.012943587265908718, 0.018922233954072, 0.028541645035147667, -0.011141469702124596, 0.012748763896524906, -0.03234070539474487, -0.022672586143016815, -0.01423429325222969, -0.013065352104604244, -0.02822505682706833, 0.0043409112840890884, -0.002840161556378007, -0.01809423416852951, 0.019920704886317253, -0.00874270498752594, -0.0020639116410166025, 0.009065382182598114, 0.006416999734938145, 0.006782293785363436, 0.006593558471649885, -0.005494631826877594, 0.007257176097482443, -0.0017290586838498712, 0.013430646620690823, -0.009984705597162247, 0.004310470074415207, 0.006176514085382223, -0.007525058463215828, -0.008706175722181797, 0.003397235181182623, 0.011640705168247223, -0.011750292964279652, 0.012450440786778927, -0.01321147009730339, -0.011159734800457954, 0.003065426368266344, 0.01548846997320652, 0.01642605848610401, -0.015013587661087513, 0.0063317641615867615, 0.007044087629765272, 0.017643705010414124, -0.016121646389365196, -0.0003573032736312598, 0.015062293037772179, -0.005339382216334343, 0.02841988019645214, -0.0004569981247186661, -0.011811175383627415, 0.008633117191493511, -0.02919917367398739, 0.0011811176082119346, -0.03302258625626564, -0.025010468438267708, -0.014599586836993694, -0.030197644606232643, -0.03139093890786171, 0.046538468450307846, 0.04222799837589264, -0.0209678802639246, -0.0037046908400952816, 0.011263234540820122, -0.021138351410627365, -0.021406233310699463, -0.03813670203089714, -0.0031065219081938267, -0.0192997045814991, -0.018629997968673706, 0.011190176010131836, 0.008797499351203442, -0.01283399946987629, -0.0027564482297748327, 0.006751852575689554, -0.022368174046278, -0.0051110731437802315, 0.20612327754497528, -0.03911082074046135, -0.007080617360770702, 0.014989234507083893, 0.024864351376891136, 0.024718234315514565, 0.015098822303116322, 0.0334852933883667, -0.015013587661087513, -0.010794440284371376, -0.011695499531924725, -0.023658880963921547, -0.04687940701842308, -1.6944793969742022e-05, 0.0023241837043315172, -0.030197644606232643, -0.04841364547610283, -0.03954917564988136, 0.002007595496252179, 0.0030517277773469687, 0.03696776181459427, 0.02483999915421009, -0.016913115978240967, -0.018617821857333183, 0.01989635080099106, -0.017692411318421364, -0.013430646620690823, 0.003978661727160215, 0.029734939336776733, 0.00179907341953367, -0.010289116762578487, -0.0299054104834795, -0.005217617377638817, 0.019056174904108047, -0.007945146411657333, -2.58512154687196e-05, 0.042812466621398926, -0.006751852575689554, 0.024401646107435226, 0.03577446937561035, 0.02525399811565876, 0.012919234111905098, -0.01193294022232294, -0.031147409230470657, 0.002480955794453621, 0.03954917564988136, -0.006276970263570547, 0.0057838233187794685, -0.040766820311546326, 0.004459632094949484, -0.0023043968249112368, 8.376079495064914e-05, 0.023427527397871017, 0.011244969442486763, 0.028809526935219765, 0.01525711640715599, 0.011872057802975178, -0.015269293449819088, 0.00769552867859602, 0.017558468505740166, -0.006971029099076986, 0.012359117157757282, -0.006989293731749058, 0.031780585646629333, -0.01712011732161045, 0.022806527093052864, -0.02637423388659954, -0.0046574994921684265, -0.007415470201522112, -0.01372288167476654, -0.016170352697372437, 0.008797499351203442, -0.0119512053206563, 0.0016468674875795841, -0.029272234067320824, -0.008797499351203442, 0.027080468833446503, 0.026033291593194008, 0.00545201450586319, 0.01436823420226574, -0.03285211697220802, 0.01814294047653675, -0.0009946654317900538, -0.0026042424142360687, 0.008736616931855679, -0.03506823256611824, 0.0034489850513637066, -0.012072970159351826, -0.0016605660784989595, 0.011378911323845387, 0.004703161306679249, -0.03027070313692093, -0.002894955687224865, 0.009869028814136982, 0.018082058057188988, 0.02055388130247593, -0.013089705258607864, 0.004246543627232313, -0.0004067701811436564, 0.009126263670623302, -0.00925411656498909, 0.020261645317077637, 0.006678793579339981, 0.013004469685256481, 0.0012884227326139808, -0.004273940809071064, 0.003966485150158405, 0.0048157935962080956, 5.988349948893301e-05, -0.01669394038617611, -0.00035806430969387293, -0.014867469668388367, 0.0043043820187449455, 0.002432249952107668, 0.009515911340713501, 0.003330264473333955, -0.00043987497338093817, 0.010149087756872177, 0.002862992463633418, 0.0023317940067499876, 0.0010646800510585308, -0.03998752683401108, 0.001006841892376542, 0.020724352449178696, 0.003652940969914198, -0.006575293838977814, -0.05459928885102272, -0.0011666580103337765, -0.006112587638199329, -0.008919264189898968, 0.016389528289437294, -0.02139405719935894, 0.03876987844705582, -0.021187057718634605, -0.0006693252944387496, 0.0034002792090177536, -0.012194734066724777, 0.0033881026320159435, -0.010276940651237965, -0.0018462572479620576, 0.018715234473347664, -0.020687822252511978, -0.02126011624932289, 0.00562857324257493, 0.008566146716475487, -0.007342411205172539, 0.01372288167476654, 0.005759470164775848, 0.005704676266759634, -0.0199450571089983, -0.03445940837264061, -0.02395111694931984, -0.015683293342590332, 0.0011483932612463832, 0.03241376206278801, -0.004012146964669228, -0.03148835152387619, -0.02027382142841816, 0.008486999198794365, 0.023415351286530495, -0.03582317382097244, -0.014027292840182781, 0.009582881815731525, -0.03056293912231922, -0.010928381234407425, 0.0009292168542742729, -0.1503063440322876, 0.002240470377728343, 0.022867409512400627, -0.017144469544291496, 0.03438635170459747, -0.0028386395424604416, 0.03915952518582344, 0.013954234309494495, 0.0011034925701096654, -0.0018142940243706107, 0.0011902499245479703, 0.0053180730901658535, -0.014575234614312649, 0.016024233773350716, -0.022477762773633003, 0.00997252855449915, -0.03107435069978237, 0.011476323008537292, 0.0056742350570857525, 0.007269352674484253, 0.02678823284804821, -0.012182557955384254, -0.011567646637558937, -0.004149131942540407, -0.001436062389984727, 0.00788426399230957, -0.008675734512507915, -0.015293645672500134, -0.01590246893465519, -0.023987645283341408, -0.0203225277364254, 0.015646763145923615, -0.00149694480933249, -0.014964881353080273, 0.0025053087156265974, -0.01072138175368309, 0.014916175045073032, -0.008584410883486271, -0.031610116362571716, 0.0176315288990736, -0.0021719778887927532, 0.02451123297214508, 0.01336976420134306, 0.00041171687189489603, -0.02515658736228943, -0.015293645672500134, 0.0003554006980266422, 0.009911646135151386, 0.025789763778448105, -0.009662028402090073, 0.019311880692839622, -0.011853793635964394, 0.007494617253541946, -0.009546352550387383, -0.011001440696418285, 0.01794811710715294, 0.0020913085900247097, 0.006770117208361626, 0.0003732849145308137, -0.03182929381728172, 0.0011940550757572055, 0.0016346910269930959, -0.0018660440109670162, 0.003540308680385351, 0.012060793116688728, -0.0012480881996452808, -0.022952646017074585, 0.03258423134684563, -0.02441382221877575, -0.00842002872377634, 0.008706175722181797, -0.047877877950668335, 0.008687911555171013, -0.007853822782635689, -0.004809705540537834, 0.007792940828949213, 0.002153713023290038, 0.017875056713819504, 0.012012087740004063, -0.0008569190395064652, -0.011622440069913864, 0.04135129228234291, -0.015305822715163231, -0.00026255514239892364, 0.00490711722522974, -0.00017874677723739296, -0.013126234523952007, 0.01383246947079897, 0.0015114042907953262, -0.0036103231832385063, 0.034118469804525375, -0.025960233062505722, 0.006757940631359816, 0.020176410675048828, 0.018008999526500702, 0.015342351980507374, -0.010130822658538818, 0.0077137937769293785, 0.0002144200261682272, 0.008907088078558445, 0.00509280851110816, 0.002779279137030244, -0.018264705315232277, 0.036261528730392456, 0.03691905736923218, -0.005263279192149639, -0.0029512718319892883, 0.0012275403132662177, 0.015074469149112701, 0.0003468391369096935, -0.03078211471438408, -0.01591464690864086, -0.012724410742521286, 0.010989263653755188, -0.013357587158679962, 0.011610263958573341, -0.011190176010131836, -0.013040998950600624, -0.0030562938190996647, 0.002601198386400938, 0.03441070392727852, -0.021917644888162613, -0.027323998510837555, 0.018386470153927803, -0.011062323115766048, 0.0008843161049298942, -0.07885482162237167, -0.01590246893465519, 0.01153111644089222, 0.01321147009730339, 0.028444234281778336, 0.025935880839824677, 0.00402432307600975, 0.01842299848794937, 0.007835558615624905, 0.038014937192201614, -0.004331779200583696, -0.005884279031306505, -0.0011476322542876005, 0.0158537644892931, 0.01692529208958149, -0.0019604116678237915, 0.009266293607652187, -0.037600938230752945, -0.006219131872057915, 0.014477822929620743, 0.026617763563990593, -0.006575293838977814, -0.018033351749181747, 0.011884234845638275, -0.02934529259800911, 0.005165867507457733, -0.021320998668670654, 0.020724352449178696, 0.008267822675406933, 0.007872087880969048, -0.004958867095410824, -0.023281410336494446, -0.010800528340041637, -0.006471793632954359, 0.013601116836071014, 0.015549351461231709, -0.014027292840182781, -0.01939711719751358, 0.0014512829948216677, -0.006270881742238998, 0.009394146502017975, 0.006751852575689554, -0.035506587475538254, -0.008359146304428577, -0.007677264045923948, -0.00916279386729002, -0.018435174599289894, -0.01053264643996954, 0.006252617109566927, -0.01679135113954544, -0.01948235183954239, -0.013759410940110683, -0.017935939133167267, -0.023683233186602592, 0.019543234258890152, 0.017728939652442932, 0.0039390879683196545, -0.004922337830066681, -0.009260205551981926, 0.022209880873560905, 0.01847170479595661, -0.02868776209652424, -0.02642294019460678, 0.01586594060063362, 0.03027070313692093, -0.004368308465927839, -0.015074469149112701, -0.015622410923242569, 0.020030293613672256, 0.010301293805241585, 0.020078998059034348, 0.029272234067320824, -0.00930282287299633, 0.041180819272994995, -0.02868776209652424, 0.015269293449819088, -0.01697399839758873, 0.0012983160559087992, -0.004118690732866526, -0.028054585680365562, 0.004490073304623365, -0.014709175564348698, 0.01576852798461914, -0.00422219093888998, 0.016681764274835587, 0.011920764110982418, 0.025497527793049812, 0.0038355879951268435, -0.02185676246881485, -0.0012998381862416863, -0.025935880839824677, 0.012943587265908718, 0.01321147009730339, 0.0003240082587581128, -0.011665058322250843, 0.004840146750211716, -0.00897405855357647, -0.041887056082487106, 0.02669082209467888, 0.012267793528735638, 0.011123205535113811, 0.001554021961055696, -0.044200584292411804, 0.01155546959489584, -0.00437135249376297, 0.007299793418496847, 0.03221894055604935, 0.002873646793887019, 0.023780645802617073, -0.017875056713819504, -0.003996926359832287, 0.023050056770443916, -0.03031940944492817, -0.00793297030031681, -0.012419999577105045, -0.0011179521679878235, -0.013357587158679962, -0.013442822732031345, 0.000937588163651526, 0.02883388102054596, -0.012450440786778927, 0.008913176134228706, -0.008925352245569229, -0.026398586109280586, 0.012133852578699589, 0.003555529285222292, -0.01388117577880621, 0.02004246972501278, -0.0045113819651305676, 0.004066940862685442, -0.020018115639686584, 0.0028097203467041254, -0.009741175919771194, -0.022940469905734062, -0.018155116587877274, 0.019701527431607246, 0.011293675750494003, -0.025059174746274948, 0.019141411408782005, -0.001108819735236466, 0.023500585928559303, 0.0426907017827034, -0.013174939900636673, -0.0242798812687397, 0.013929881155490875, -0.00792688224464655, -0.0037594849709421396, -0.011981646530330181, 0.010751822963356972, 0.01688876375555992, 0.008919264189898968, 0.02223423309624195, 0.012773117050528526, 0.02437729202210903, 0.02561929263174534, -0.019141411408782005, -0.013053175993263721, -0.0011704631615430117, 0.00509280851110816, -0.017412351444363594, 0.03163446858525276, -0.005409396719187498, 0.015512822195887566, -0.010301293805241585, -0.006855352316051722, 0.02283088117837906, 0.014295175671577454, 0.014356058090925217, -0.003957352600991726, 0.005421573296189308, -0.001847779261879623, -0.02255082130432129, -0.01439258735626936, 0.020626939833164215, 0.0022161174565553665, 0.03487341105937958, 0.0029847570694983006, 0.022684762254357338, -0.011433704756200314, 0.022222056984901428, -0.013735057786107063, 0.028858233243227005, 0.020164234563708305, 0.021613234654068947, -0.009680293500423431, 0.013966410420835018, -0.0022328600753098726, -0.0012907057534903288, 0.005996911320835352, -0.002333316020667553, 0.019457999616861343, -0.008456557989120483, -0.005582911428064108, 0.013978587463498116, 0.0025540145579725504, 0.00561639666557312, -0.005701631773263216, -0.0027062203735113144, -0.001362242503091693, -0.020298175513744354, -0.02167411707341671, 0.0012891837395727634, 0.017363645136356354, -0.012237352319061756, 0.014246469363570213, -0.0012701579835265875, -0.015524999238550663, -0.0006822628201916814, 0.0041460879147052765, -0.03786882013082504, 0.0033028675243258476, 0.020395586267113686, -0.00012642600631807, -0.010806617327034473, -0.01766805723309517, 0.008298263885080814, -0.014088175259530544, 0.0032389408443123102, 0.005872102454304695, -0.006971029099076986, -0.02213682234287262, 0.04283681884407997, -0.000533101090695709, 0.023658880963921547, 0.02482782118022442, -0.014088175259530544, 0.020432116463780403, 0.013795940205454826, 0.008085176348686218, 0.003375926287844777, -0.002257212996482849, 0.01364982221275568, -0.027323998510837555, 0.010934470221400261, 0.004426146857440472, -0.0029345292132347822, 0.004438323434442282, -0.013223646208643913, -0.006362205371260643, 0.012748763896524906, 0.00769552867859602, 0.08085175603628159, 0.008012116886675358, -0.002318095415830612, 0.011805087327957153, -0.005680323112756014, 0.031610116362571716, 0.014648293145000935, 0.017753293737769127, -0.03523870185017586, -0.020992234349250793, 0.05021576210856438, -0.0058690584264695644, 0.009552440606057644, -0.013040998950600624, -0.02088264562189579, -0.016949646174907684, -0.015184057876467705, 0.02581411600112915, -0.026057645678520203, -0.014794411137700081, 0.030221998691558838, -0.03567705675959587, -0.012821822427213192, -0.002339404309168458, -0.023926762863993645, 0.015756351873278618, 0.018155116587877274, 0.009570705704391003, 0.020773056894540787, -0.018106410279870033, -0.0027868894394487143, 0.03701646625995636, -0.03516564518213272, -0.0036072791554033756, -0.01032564602792263, -0.006447440944612026, -0.015037939883768559, -0.014136881567537785, 0.03825846686959267, -0.00935152918100357, 0.015987705439329147, 0.028103291988372803, -0.029686233028769493, -0.004690985195338726, 0.0036346763372421265, 0.0032632939983159304, 0.004827970173209906, 0.028639057651162148, -0.020200762897729874]

    pipeline = [
        {
            "$search": {
                "cosmosSearch": {
                    "vector": queryVector,
                    "path": "vectorContent",
                    "k": 2
                },
                "returnStoredSource": True
            }
        }
    ]

    result = db.Catalog.aggregate(pipeline)
    # Print the result
    print("Search resut:")
    for document in result:
        print(document)


# --------------------------------------------
# aşağıdaki işlemlerden önce ilgili azure resource tanımlarının yapılmış olması gerekir. Bunun için azurecli dizinindeki dosya kullanılır.
# Aşağıdaki kısım bir kez çalıştırılır.

# create database and collection
# CreateDatabase()
# ExportEmbeddings()  
# --------------------------------------------

# ReadEmbeddingsFromCosmoDB()  # nosql için  >700 maddeyi çekmesi epey vakit alıyor. mongodb içn biraz daha hızlı 
# searchmongodb()
# createmongodbvectorindex()
# deletemongodbrecords()
# query_items("1")
# createvectorindex()
